.. _v2.0-release-notes:

v2.0 Release Notes
==================

Highlights in 2.0:

- `Breaking Changes`_
- `Pinning apps to the dashboard`_
- `Customizable layouts in the dashboard`_
- `Adding metadata to app manifests`_
- `Shell app now has themes`_
- `Configurations in an ondemand.d directory`_
- `ActiveJobs now a part of the dashboard`_
- `New File Manager app`_
- `Changes in All Apps page layout`_
- `Dependency updates`_

Upgrading from v1.8
-------------------

Breaking Changes
................

.. warning::

   There are some breaking changes in 2.0 that you'll need to work through to upgrade.


No longer providing ood_auth_map.regex
**************************************

2.0 no longer provides ``/opt/ood/ood_auth_map/bin/ood_auth_map.regex`` the 1.8- default 
``user_map_cmd`` in ``ood_portal.yml``.

Most sites should be able to use ``user_map_match`` instead.  You can still use
``user_map_cmd``, only you'll have to write your own in a language of your choice.

See the :ref:`documentation on user_map_match <ood-portal-generator-user-map-match>`
for more information on it.

ActiveJobs configuration changes
********************************

Because `ActiveJobs now a part of the dashboard`_ configuration files are no longer
being read from ``/etc/ood/config/apps/activejobs``.

If you have initializers here in this directory, they need to move to
``/etc/ood/config/apps/dashboard/initializers``.  Similarly views, if any,
need to move to ``/etc/ood/config/apps/dashboard/views``.

If you used the class ``Filter`` to add or modify the filter menus in an initializer,
this now needs to be ``ActiveJobs::Filter``.

Files app configuration changes
********************************

Because there's a `new file manager app`_ that's a part of the dashboard, so configurations
in ``/etc/ood/config/apps/files`` need to move to ``/etc/ood/config/apps/dashboard`` for
them to take effect.

.. warning::

   As always please update the *development* or *test* instances of OnDemand installed at your center first to test and verify before you modify the *production* instance.

.. warning::

   The OnDemand upgrade has only been tested going from 1.8.x to 2.0.x.

#. Update OnDemand release RPM

   .. code-block:: sh

      sudo yum install -y https://yum.osc.edu/ondemand/2.0/ondemand-release-web-2.0-1.noarch.rpm

#. Enable dependency repos

   **CentOS/RHEL 8 only**

   .. code-block:: sh

      sudo dnf module reset ruby
      sudo dnf module enable ruby:2.7
      sudo dnf module reset nodejs
      sudo dnf module enable nodejs:12

   **RedHat 8 only**

   .. code-block:: sh

      sudo subscription-manager repos --enable codeready-builder-for-rhel-8-x86_64-rpms

   **CentOS 8 only**

   .. code-block:: sh

      sudo dnf config-manager --set-enabled powertools

   **CentOS/RHEL 7 only**

   .. code-block:: sh

      sudo yum install epel-release

#. Update OnDemand

   .. code-block:: sh

      sudo yum clean all
      sudo yum update ondemand

#. (Optional) If using Dex based authentiction, update the ``ondemand-dex`` package.

   .. code-block:: sh

      sudo yum update ondemand-dex

#. Update Apache configuration and restart Apache.

   .. code-block:: sh

      sudo /opt/ood/ood-portal-generator/sbin/update_ood_portal

   **CentOS/RHEL 8 only**

   .. code-block:: sh

      sudo systemctl try-restart httpd

   **CentOS/RHEL 7 only**

   .. code-block:: sh

      sudo systemctl try-restart httpd24-httpd.service

#. (Optional) If ``ondemand-dex`` was installed, restart the ``ondemand-dex`` service.

   .. code-block:: sh

      sudo systemctl try-restart ondemand-dex.service

#. Force all PUNs to restart

   .. code-block:: sh

      sudo /opt/ood/nginx_stage/sbin/nginx_stage nginx_clean -f

#. (Optional) Remove old dependencies from prior versions of OOD if they are not used by other applications.

   .. warning::

      See `Dependency updates`_ warning before uninstalling old Ruby versions.

   **CentOS/RHEL 7 only**

   .. code-block:: sh

      sudo yum remove rh-ruby25\* rh-nodejs10\*


Details
-------

Pinning apps to the dashboard
.............................

See the :ref:`documentation on pinning apps to the dashboard <dashboard_pinned_apps>` for details.

Customizable layouts in the dashboard
.....................................

See the :ref:`documentation on customizing dashboard layouts <dashboard_custom_layout>` for details.

Adding metadata to app manifests
................................

App manifest files now allow for metedata fields for grouping and diplay in the all apps table.
See :ref:`documentation on manifest files <app-development-manifest>` for more details.

Shell app now has themes
........................

The shell app now allows for users to choose a color themes than the default and ships with
thirteen extra themes.


Configurations in an ondemand.d directory
.........................................

We've added an ondemand.d directory to start moving configurations there. Some new features for
2.0 rely on configurations read from files in this directory.

See :ref:`the documentation for the ondemand.d configurations <ondemand-d-ymls>` for all the
available configurations.

ActiveJobs now a part of the dashboard
......................................

ActiveJobs is now a part of the dashboard. The URL has changed, but redirects from the old
URL should still work in case sites have this saved somewhere.

The primary benefit to users will be that the navbar is visible in this app now.

However you should view `ActiveJobs configuration changes`_ for the breaking changes this
introduced.

New File Manager app
....................

2.0 released with a new File manager application.  This looks and feels differently than
the previous version, but should have the same functionality.  The previous version was a
dependency not created or managed by the maintainers of Open OnDemand, and so it was hard
to add features to and keep up to date.

See the `files app configuration changes`_ for any changes you'll need to update to the
configurations of this new app.

Here's what this new app looks like. As you can see there are buttons for upload, download
and more.

.. figure:: /images/2.0_files_app.png

Changes in All Apps page layout
...............................

The 'All Apps' page is now a filterable table instead of cards.  Note that new columns will
be dynamically added by `adding metadata to app manifests`_.


Dependency updates
..................

This release updates the following dependencies:

- Ruby 2.7
- NodeJS 12
- Passenger 6.0.7
- NGINX 1.18.0

  .. warning:: The change in Ruby version means any Ruby based apps that are not provided by the OnDemand RPM must be rebuilt.



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Enabling App Development &mdash; Open OnDemand 1.4.9 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Interactive Apps" href="interactive.html" />
    <link rel="prev" title="App Development" href="../app-development.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/add-cluster-config.html">Add Cluster Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/resource-manager.html">Resource Manager Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customization_overview.html">Customization Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customization.html">Customization</a></li>
</ul>
<p class="caption"><span class="caption-text">Extend</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="interactive/setup.html">Setup Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enable-desktops.html">Enable Interactive Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install-ihpc-apps.html">Install Other Interactive Apps</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../app-development.html">App Development</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Enabling App Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="interactive.html">Interactive Apps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials-interactive-apps.html">Tutorials: Interactive Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials-passenger-apps.html">Tutorials: Passenger Apps</a></li>
</ul>
<p class="caption"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release-notes/v1.4-release-notes.html">v1.4 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes/v1.3-release-notes.html">v1.3 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes/v1.2-release-notes.html">v1.2 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes/v1.1-release-notes.html">v1.1 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes/v1.0-release-notes.html">v1.0 Release Notes</a></li>
</ul>
<p class="caption"><span class="caption-text">Legacy Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-documentation.html">User Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Open OnDemand</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../app-development.html">App Development</a> &raquo;</li>
        
      <li>Enabling App Development</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OSC/ood-documentation/blob/release-1.4/source/app-development/enabling-development-mode.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="enabling-app-development">
<span id="enabling-development-mode"></span><h1>Enabling App Development<a class="headerlink" href="#enabling-app-development" title="Permalink to this headline">¶</a></h1>
<p>There are three steps to enabling app development:</p>
<ol class="arabic simple">
<li>The PUN must have the config set so the app root looks to the path in the user’s home directory, or whatever per-user path dev apps should reside. This is configurable in the nginx_stage, though the default template string can be used as is.</li>
<li>The Dashboard app needs to be informed that developer mode is enabled for the user, in order to show the Develop dropdown. By default, the Dashboard does this based on the existence of the path specified by <code class="docutils literal notranslate"><span class="pre">OOD_DEV_APPS_ROOT</span></code> which is set by taking the parent path of the interpolated value of <code class="docutils literal notranslate"><span class="pre">app_root</span></code> for dev apps (<a class="reference external" href="https://github.com/OSC/ondemand/blob/d85a3982d69746144d12bb808d2419b42ccc97a1/nginx_stage/share/nginx_stage_example.yml#L145-L159">see the example nginx_stage.yml config file</a>). There are also other options for configuring the Dashboard at the bottom of this page.</li>
<li>Specify the development host, if it will differ from the default host for the shell app by setting it in <code class="docutils literal notranslate"><span class="pre">OOD_DEV_SSH_HOST</span></code> environment variable for the dashboard in the file <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/dashboard/env</span></code>. When developing apps, it is necessary to have access to the same versions of Ruby and NodeJS that are running on the OnDemand node. If the default ssh host is not the OnDemand node, then setting <code class="docutils literal notranslate"><span class="pre">OOD_DEV_SSH_HOST</span></code> to a host developers can ssh to with the same Software Collection (SCL) packages will help.</li>
</ol>
<p>In OnDemand 1.3, the app root for a dev app was set in the PUN config to <code class="docutils literal notranslate"><span class="pre">'~%{owner}/%{portal}/dev/%{name}'</span></code>. This means for a user with the home directory <code class="docutils literal notranslate"><span class="pre">/home/efranz</span></code> in a default OnDemand install the root directory for the dev apps would be <code class="docutils literal notranslate"><span class="pre">/home/efranz/ondemand/dev</span></code>. If a user did <code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">~/ondemand/dev</span></code> and reloaded the Dashboard app, the Develop dropdown would appear and users could deploy apps in their home directory and launch them.</p>
<p>In OnDemand 1.4, the app root for a dev app has been changed to <code class="docutils literal notranslate"><span class="pre">'/var/www/ood/apps/dev/%{owner}/gateway/%{name}'</span></code>. So for user <code class="docutils literal notranslate"><span class="pre">efranz</span></code> this would be <code class="docutils literal notranslate"><span class="pre">/var/www/ood/apps/dev/efranz/gateway/</span></code>. To enable efranz to develop apps, the administrator can then do the following:</p>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">ood</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">efranz</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">ood</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">efranz</span>
<span class="n">sudo</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">efranz</span><span class="o">/</span><span class="n">ondemand</span><span class="o">/</span><span class="n">dev</span> <span class="n">gateway</span>
</pre></div>
</div>
<p>Then a user can create the dev directory in their home directory i.e. <code class="docutils literal notranslate"><span class="pre">/home/efranz/ondemand/dev</span></code>.</p>
<p>If you want to revert to the previous functionality of 1.3, where every user can run dev apps in their home directory, <a class="reference external" href="https://github.com/OSC/ondemand/blob/d85a3982d69746144d12bb808d2419b42ccc97a1/nginx_stage/share/nginx_stage_example.yml#L156-L159">use the second example mapping here</a> in the <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/nginx_stage.yml</span></code> config file. If you do this, it is recommended that you treat the node that OnDemand is running on as a login node, as you are effectively giving those users shell access by letting them run arbitrary code on the OnDemand node (of course the UID of the processes are still their regular user UID).</p>
<p>By default the Dashboard will assume it is running in “Developer mode” if the dev apps root directory exists (specified by the environment variable <code class="docutils literal notranslate"><span class="pre">OOD_DEV_APPS_ROOT</span></code>). If you want to change this behavior, these are the options:</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-number">Table 8 </span><span class="caption-text">Dashboard configuration for app development</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Action</td>
<td>Result</td>
</tr>
<tr class="row-even"><td>Set <code class="docutils literal notranslate"><span class="pre">OOD_APP_DEVELOPMENT=1</span></code> in <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/dashboard/env</span></code></td>
<td>Developer mode will always be enabled in the Dashboard providing a Develop Dropdown. This can help with discoverability, as user’s do not need to create the dev root directory prior to seeing the Develop dropdown. This only makes sense if every user can develop apps.</td>
</tr>
<tr class="row-odd"><td>Set <code class="docutils literal notranslate"><span class="pre">Configuration.app_development_enabled</span></code> to true based on one or more Ruby statements in <code class="docutils literal notranslate"><span class="pre">/etc/ood/config/apps/dashboard/initializers/ood.rb</span></code></td>
<td><p class="first">Code in the initializer runs as the user. This code also has access to the <a class="reference external" href="http://www.rubydoc.info/github/OSC/ood_support">ood_support library</a> in which we provide some helper classes to work with User’s and Groups.</p>
<p>If you want to restrict app development mode to group membership, you could
do this:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Configuration</span><span class="o">.</span><span class="n">app_development_enabled</span> <span class="o">=</span> <span class="no">OodSupport</span><span class="o">::</span><span class="no">Process</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span>
  <span class="no">OodSupport</span><span class="o">::</span><span class="no">Group</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;devgrp&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Or if you know the id of the group, this will avoid reading the <code class="docutils literal notranslate"><span class="pre">/etc/group</span></code>
file:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Configuration</span><span class="o">.</span><span class="n">app_development_enabled</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="mi">5014</span><span class="p">)</span>
</pre></div>
</div>
<p>Or a specific user list:</p>
<div class="last highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Configuration</span><span class="o">.</span><span class="n">app_development_enabled</span> <span class="o">=</span> <span class="sx">%w(</span>
<span class="sx">  bgohar efranz bmcmichael</span>
<span class="sx">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="no">OodSupport</span><span class="o">::</span><span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The way app development is enabled is a bit clunky. We will be exploring
other options to reduce the load on the admin in supporting app developers
in the future. If you have any thoughts or ideas please share them on our
<a class="reference external" href="https://discourse.osc.edu/">Discourse instance.</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="interactive.html" class="btn btn-neutral float-right" title="Interactive Apps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../app-development.html" class="btn btn-neutral float-left" title="App Development" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, Ohio Supercomputer Center

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Documentation Versions</span>
    v: 
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="https://OSC.github.io/ood-documentation/latest/app-development/enabling-development-mode.html">latest</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.7/app-development/enabling-development-mode.html">1.7</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.6/app-development/enabling-development-mode.html">1.6</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.5/app-development/enabling-development-mode.html">1.5</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.4/app-development/enabling-development-mode.html">1.4</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.3/app-development/enabling-development-mode.html">1.3</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.2/app-development/enabling-development-mode.html">1.2</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.1/app-development/enabling-development-mode.html">1.1</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/release-1.0/app-development/enabling-development-mode.html">1.0</a></dd>
      
        <dd><a href="https://OSC.github.io/ood-documentation/develop/app-development/enabling-development-mode.html">develop</a></dd>
      
    </dl>
    <dl>
      <dt>On GitHub</dt>
        <dd>
          <a href="http://openondemand.org/">Website</a>
        </dd>
        <dd>
          <a href="https://github.com/OSC/Open-OnDemand">Main Repo</a>
        </dd>
    </dl>
    <hr/>
    Theme provided by <a href="http://www.readthedocs.org">Read the Docs</a>.
  </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>